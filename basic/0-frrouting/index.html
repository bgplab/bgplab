<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ivan Pepelnjak, ipSpace.net AG">
        <link rel="canonical" href="https://bgplabs.net/basic/0-frrouting/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Configuring Cumulus Linux and FRRouting &#171; BGP Labs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BGP Labs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Home <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../.." class="dropdown-item">Labs Overview</a>
</li>
                                    
<li>
    <a href="../../2-labs-by-technology/" class="dropdown-item">Labs by BGP Attributes and Technologies</a>
</li>
                                    
<li>
    <a href="../../3-upcoming/" class="dropdown-item">Upcoming Labs</a>
</li>
                                    
<li>
    <a href="../../99-about/" class="dropdown-item">About the Project</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../1-setup/" class="dropdown-item">Installation and Setup</a>
</li>
                                    
<li>
    <a href="../../4-codespaces/" class="dropdown-item">Use GitHub Codespaces</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Custom Lab Infrastructure</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../external/" class="dropdown-item">Manual Setup</a>
</li>
            
<li>
    <a href="../../external/4-router/" class="dropdown-item">Small (4-Router) Lab Topology</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Deploy BGP <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Setting Up BGP</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Configuring Cumulus Linux and FRRouting</a>
</li>
            
<li>
    <a href="../1-session/" class="dropdown-item">Configure a Single EBGP Session</a>
</li>
            
<li>
    <a href="../2-multihomed/" class="dropdown-item">Configure Multiple EBGP Sessions</a>
</li>
            
<li>
    <a href="../3-originate/" class="dropdown-item">Advertise IPv4 Prefixes to BGP Neighbors</a>
</li>
            
<li>
    <a href="../4-ipv6/" class="dropdown-item">Configure BGP for IPv6</a>
</li>
            
<li>
    <a href="../5-redistribute/" class="dropdown-item">Redistribute IGP Information Into BGP</a>
</li>
            
<li>
    <a href="../d-interface/" class="dropdown-item">EBGP Sessions over IPv6 LLA Interfaces</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Protecting BGP Sessions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../6-protect/" class="dropdown-item">MD5 Passwords and GTSM</a>
</li>
            
<li>
    <a href="../9-ao/" class="dropdown-item">TCP Autentication Option (TCP-AO)</a>
</li>
            
<li>
    <a href="../b-max-prefix/" class="dropdown-item">Limit the Number of Accepted BGP Prefixes</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">BGP in Larger Networks</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ibgp/1-edge/" class="dropdown-item">Establish an IBGP Session</a>
</li>
            
<li>
    <a href="../../ibgp/2-transit/" class="dropdown-item">Build a Transit Network with IBGP</a>
</li>
            
<li>
    <a href="../../ibgp/3-rr/" class="dropdown-item">Use BGP Route Reflectors</a>
</li>
            
<li>
    <a href="../../session/6-templates/" class="dropdown-item">BGP Session Templates</a>
</li>
            
<li>
    <a href="../../session/7-policy/" class="dropdown-item">BGP Policy Templates</a>
</li>
            
<li>
    <a href="../../session/9-dynamic/" class="dropdown-item">Dynamic BGP Peers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Manipulate AS Path</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../session/1-allowas_in/" class="dropdown-item">Reuse a BGP AS Number Across Multiple Sites</a>
</li>
            
<li>
    <a href="../../session/2-asoverride/" class="dropdown-item">Fix AS-Path in Environments Reusing BGP AS Numbers</a>
</li>
            
<li>
    <a href="../../session/3-localas/" class="dropdown-item">Use Multiple AS Numbers on the Same Router</a>
</li>
            
<li>
    <a href="../../session/4-removeprivate/" class="dropdown-item">Remove Private BGP AS Numbers from the AS Path</a>
</li>
            
<li>
    <a href="../../session/5-routeserver/" class="dropdown-item">BGP Route Server in an Internet Exchange Point</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Load Balancing</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../lb/1-ebgp/" class="dropdown-item">Load Balancing across External BGP Paths</a>
</li>
            
<li>
    <a href="../../lb/2-dmz-bw/" class="dropdown-item">EBGP Load Balancing with BGP Link Bandwidth</a>
</li>
            
<li>
    <a href="../../lb/3-ibgp/" class="dropdown-item">IBGP Load Balancing with BGP Link Bandwidth</a>
</li>
            
<li>
    <a href="../../lb/4-ibgp-add-path/" class="dropdown-item">IBGP Load Balancing with BGP Additional Paths</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Other Useful Topics</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../7-bfd/" class="dropdown-item">Use BGP Timers and BFD to Speed Up BGP Convergence</a>
</li>
            
<li>
    <a href="../8-aggregate/" class="dropdown-item">BGP Route Aggregation</a>
</li>
            
<li>
    <a href="../c-default-route/" class="dropdown-item">Advertise Default Route in BGP</a>
</li>
            
<li>
    <a href="../d-interface/" class="dropdown-item">EBGP Sessions over IPv6 LLA Interfaces</a>
</li>
            
<li>
    <a href="../e-ebgp-multihop/" class="dropdown-item">Running EBGP Across a Firewall</a>
</li>
            
<li>
    <a href="../../session/8-passive/" class="dropdown-item">Passive BGP Sessions</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Routing Policies <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../policy/" class="dropdown-item">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Route Filters</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../policy/2-stop-transit/" class="dropdown-item">Filter Transit Routes</a>
</li>
            
<li>
    <a href="../../policy/3-prefix/" class="dropdown-item">Filter Advertised Prefixes</a>
</li>
            
<li>
    <a href="../../policy/4-reduce/" class="dropdown-item">Minimize the Size of Your BGP Table</a>
</li>
            
<li>
    <a href="../b-max-prefix/" class="dropdown-item">Limit the Number of Accepted BGP Prefixes</a>
</li>
            
<li>
    <a href="../../policy/d-no-export/" class="dropdown-item">Using No-Export Community to Filter Transit Routes</a>
</li>
            
<li>
    <a href="../../policy/f-orf/" class="dropdown-item">Use Outbound Route Filters (ORF) for IP Prefixes</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Outgoing (Egress) Traffic</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../policy/1-weights/" class="dropdown-item">Select Preferred EBGP Peer with Weights</a>
</li>
            
<li>
    <a href="../../policy/5-local-preference/" class="dropdown-item">Select Preferred Uplink with BGP Local Preference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Incoming (Ingress) Traffic</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../policy/6-med/" class="dropdown-item">Use MED to Influence Incoming Traffic Flow</a>
</li>
            
<li>
    <a href="../../policy/7-prepend/" class="dropdown-item">Use AS-Path Prepending to Influence Incoming Traffic Flow</a>
</li>
            
<li>
    <a href="../../policy/8-community-attach/" class="dropdown-item">Attach BGP Communities to Outgoing BGP Updates</a>
</li>
            
<li>
    <a href="../../policy/e-wedgies/" class="dropdown-item">Resolve BGP Wedgies</a>
</li>
            
<li>
    <a href="../../policy/b-disaggregate/" class="dropdown-item">Use Disaggregated Prefixes to Select the Primary Link</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">More Complex Routing Policies</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../policy/9-community-use/" class="dropdown-item">Use BGP Communities in Routing Policies</a>
</li>
            
<li>
    <a href="../../policy/a-locpref-route-map/" class="dropdown-item">BGP Local Preference in a Complex Routing Policy</a>
</li>
            
<li>
    <a href="../../session/7-policy/" class="dropdown-item">BGP Policy Templates</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Challenges <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../challenge/03-graceful-shutdown/" class="dropdown-item">BGP Graceful Shutdown</a>
</li>
                                    
<li>
    <a href="../../challenge/04-block-fat-fingers/" class="dropdown-item">Stop the Propagation of Configuration Errors</a>
</li>
                                    
<li>
    <a href="../../challenge/20-merge-as/" class="dropdown-item">Merge Networks Using Different BGP AS Numbers</a>
</li>
                                    
<li>
    <a href="../../challenge/30-reduce-fib/" class="dropdown-item">Minimize the Forwarding Table on BGP Routers</a>
</li>
                                    
<li>
    <a href="../../challenge/40-mpls-core/" class="dropdown-item">BGP-Free Core in a Transit Network</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Upcoming <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../3-upcoming/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../challenge/01-bird-rr/" class="dropdown-item">Using Bird BGP Daemon as a BGP Route Reflector</a>
</li>
                                    
<li>
    <a href="../../challenge/02-anycast/" class="dropdown-item">Implement Anycast Services with BGP</a>
</li>
                                    
<li>
    <a href="../../challenge/05-ebgp-dc/" class="dropdown-item">EBGP-Only Data Center Design</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../1-session/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>

                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3">
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
  <div class="navbar-header">
      <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
          <span class="fa fa-angle-down"></span>
      </button>
  </div>

  
  
  
  
  
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary"  style="margin-bottom: 1em;">
      <ul class="nav flex-column">
          
      <li class="nav-item" data-level="1"><a href="#configuring-cumulus-linux-and-frrouting" class="nav-link">Configuring Cumulus Linux and FRRouting</a>
        <ul class="nav flex-column">
      <li class="nav-item" data-level="2"><a href="#start-the-lab" class="nav-link">Start the Lab</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#daemon" class="nav-link">Start the BGP Daemon</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#vtysh" class="nav-link">Work with the FRRouting CLI</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#sudo" class="nav-link">To Sudo Or Not to Sudo</a>
        <ul class="nav flex-column">
        </ul>
      </li>
      <li class="nav-item" data-level="2"><a href="#using-output-filters" class="nav-link">Using Output Filters</a>
        <ul class="nav flex-column">
        </ul>
      </li>
        </ul>
      </li>
      </ul>
    </div>
  
  
  
  
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="configuring-cumulus-linux-and-frrouting">Configuring Cumulus Linux and FRRouting</h1>
<p>Most networking devices<sup id="fnref:CL"><a class="footnote-ref" href="#fn:CL">1</a></sup> use a configuration command line interface (CLI) to interact with the end-user. The CLI usually provides <strong>show</strong> commands to inspect the state of the device and a configuration mode that allows the user to configure the device.</p>
<p>Cumulus Linux and FRRouting are different. They are implemented as an application/management layer on top of Linux, and Linux shell is used as the initial CLI. To configure them, you have to:</p>
<ul>
<li>Use standard Linux tools like <em>ifupdown</em> to configure the interfaces;</li>
<li><a href="#daemon">Edit FRRouting configuration files</a> to start routing protocol daemons</li>
<li><a href="#vtysh">Start FRRouting configuration shell</a> from the Linux CLI.</li>
</ul>
<p>The Linux interfaces and IP addresses will be configured automatically if you start the BGP labs with the <strong>netlab up</strong> command. You will have to start the routing protocol daemons in the initial lab exercises if you plan to use Cumulus Linux or FRRouting as the user routers, and you might have to execute <strong>show</strong> commands on Cumulus Linux or FRRouting acting as the external routers. You&rsquo;ll practice both in this lab exercise.</p>
<p><img alt="Lab topology" src="../topology-session.png" /></p>
<h2 id="start-the-lab">Start the Lab</h2>
<p>Assuming you already <a href="../../1-setup/">set up your lab infrastructure</a>:</p>
<ul>
<li>Change directory to <code>basic/0-frrouting</code></li>
<li>Execute <strong>netlab up</strong> to start a lab with two Cumulus Linux or FRR virtual machines or containers (depending on your lab setup).</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The lab topology uses Cumulus Linux virtual machines or containers. It switches to FRR containers if you&rsquo;re running the labs on an ARM CPU (for example, on <a href="https://blog.ipspace.net/2024/03/netlab-bgp-apple-silicon.html">Macbooks using Apple silicon</a>).</p>
</div>
<ul>
<li>Log into the devices (<code>rtr</code> and <code>x1</code>) with the <strong>netlab connect</strong> command.</li>
</ul>
<h2 id="daemon">Start the BGP Daemon</h2>
<p>Most network devices start routing daemons when you configure them through the configuration CLI or API. FRRouting (the routing daemons used in Cumulus Linux) is different: you have to enable the desired routing daemons in a configuration file and restart the top-level FRRouting process.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can skip this step if you use NVUE CLI to configure routing on Cumulus Linux 5.x &ndash; it automatically enables FRR daemons before configuring them.</p>
</div>
<p>You can check the FRR daemons running on your Cumulus Linux devices or FRR running in a Linux virtual machine with the <code>sudo systemctl status frr.service</code> command. It displays the running FRR daemons and the recent FRR logging messages, for example<sup id="fnref:DEV"><a class="footnote-ref" href="#fn:DEV">2</a></sup>:</p>
<pre><code class="language-bash">rtr(bash)#sudo systemctl status frr.service
* frr.service - FRRouting
   Loaded: loaded (/lib/systemd/system/frr.service; enabled; vendor preset: enabled)
   Active: active (running) since Wed 2024-06-26 17:09:37 UTC; 2min 27s ago
     Docs: https://frrouting.readthedocs.io/en/latest/setup.html
  Process: 2230 ExecReload=/usr/lib/frr/frrinit.sh reload (code=exited, status=0/SUCCESS)
   Status: &quot;FRR Operational&quot;
    Tasks: 17 (limit: 737)
   Memory: 19.2M
      CPU: 690ms
   CGroup: /system.slice/frr.service
           |-1875 /usr/lib/frr/zebra -d -F datacenter -M cumulus_mlag -M snmp -A 127.0.0.1 -s 90000000
           |-1889 /usr/lib/frr/staticd -d -F datacenter -A 127.0.0.1
           |-2246 /usr/lib/frr/watchfrr -d -F datacenter zebra bgpd staticd
           `-2255 /usr/lib/frr/bgpd -d -F datacenter -M snmp -A 127.0.0.1

Jun 26 17:10:01 cc bgpd[2255]: Configuration Read in Took: 00:00:00
Jun 26 17:10:01 cc staticd[1889]: Configuration Read in Took: 00:00:00
Jun 26 17:10:03 cc bgpd[2255]: %ADJCHANGE: neighbor 172.16.1.4(fc) in vrf default Up
</code></pre>
<p>You cannot use the same command in FRR containers as they don&rsquo;t use <code>systemd</code>. The easiest way to find FRR daemons in FRR containers is to use the <code>ps -ef|grep frr</code> command<sup id="fnref:UE"><a class="footnote-ref" href="#fn:UE">3</a></sup>. This is the printout you could get when the BGP daemon is already running:</p>
<pre><code class="language-bash">rtr(bash)#ps -ef|grep frr
    1 root      0:00 /sbin/tini -- /usr/lib/frr/docker-start
   26 root      0:00 /usr/lib/frr/watchfrr -d -F datacenter zebra bgpd staticd
   41 frr       0:00 /usr/lib/frr/zebra -d -F datacenter -A 127.0.0.1 -s 90000000
   46 frr       0:00 /usr/lib/frr/bgpd -d -F datacenter -A 127.0.0.1
   53 frr       0:00 /usr/lib/frr/staticd -d -F datacenter -A 127.0.0.1
  342 root      0:00 grep frr
</code></pre>
<p>The list of FRRouting daemons you want to enable is stored in the <code>/etc/frr/daemons</code> file. To enable the FRRouting BGP daemon, you have to:</p>
<ul>
<li>Add the <code>bgpd=yes</code> line to the <code>/etc/frr/daemons</code> file<sup id="fnref:FRMD"><a class="footnote-ref" href="#fn:FRMD">4</a></sup>.</li>
<li>Restart FRRouting with the <code>sudo systemctl restart frr.service</code> command (see also: <a href="#sudo">using sudo</a>)</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>You cannot change the FRR daemons in FRR containers. Restarting FRR would kill the container. <em>netlab</em> takes care of that and enables all the daemons necessary to complete the lab exercises.</li>
<li>Restarting FRR daemons wipes out the current (running) configuration. If you want to retain it, save it to the startup configuration with the <em>vtysh</em> <strong>write</strong> command.</li>
<li>The <strong>write</strong> command saves the running configuration (that you can inspect with <strong>show running-config</strong>) into the <code>/etc/frr/frr.conf</code> file. However, the <strong>show startup-config</strong><sup id="fnref:CLSC"><a class="footnote-ref" href="#fn:CLSC">5</a></sup> does not display the content of that file. Exit <em>vtysh</em> and use the <strong>more /etc/frr/frr.conf</strong> command<sup id="fnref:MNS"><a class="footnote-ref" href="#fn:MNS">6</a></sup> to inspect it.</li>
</ul>
</div>
<p>You could add the required line to the FRRouting daemons file with any text editor<sup id="fnref:TE"><a class="footnote-ref" href="#fn:TE">7</a></sup> or use the following trick:</p>
<ul>
<li>Use <strong>sudo bash</strong> to start another Linux shell as the root user</li>
<li>Use the <strong>echo</strong> command with output redirection to add a line to the <code>/etc/frr/daemons</code> file.</li>
</ul>
<pre><code class="language-bash">rtr(bash)#sudo bash
root@rtr:/# echo 'bgpd=yes' &gt;&gt;/etc/frr/daemons
root@rtr:/# exit
</code></pre>
<p>After enabling the BGP daemon and restarting FRR, you should see the <code>bgpd</code> process in the <code>ps -ef</code> printout or the BGP daemon mentioned in the <code>sudo systemctl status frr.service</code> printout.</p>
<h2 id="vtysh">Work with the FRRouting CLI</h2>
<p>FRRouting suite includes a virtual shell (<em>vtysh</em>) closely resembling industry-standard CLI<sup id="fnref:ISC"><a class="footnote-ref" href="#fn:ISC">8</a></sup>. It has to be started from the Linux command line with the vtysh command. The <code>vtysh</code> CLI has to run as the root user unless you change the FRR-related permissions to allow a regular user to use it. The usual command to start the <em>vtysh</em> is thus <code>sudo vtysh</code> (but see also <a href="#sudo">To Sudo Or Not to Sudo</a>).</p>
<pre><code class="language-bash">rtr(bash)#sudo vtysh

Hello, this is FRRouting (version 7.5+cl4.4.0u4).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

rtr#
</code></pre>
<p>Once you started <em>vtysh</em>, you can execute <strong>show</strong> commands to inspect the device state, for example:</p>
<pre><code class="language-bash">x1(bash)#sudo vtysh

Hello, this is FRRouting (version 7.5+cl4.4.0u4).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

x1# show ip bgp
BGP table version is 1, local router ID is 10.0.0.2, vrf id 0
Default local pref 100, local AS 65100
Status codes:  s suppressed, d damped, h history, * valid, &gt; best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, &lt; announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete

   Network          Next Hop            Metric LocPrf Weight Path
*&gt; 10.0.0.2/32      0.0.0.0                  0         32768 i

Displayed  1 routes and 1 total paths
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Starting with <em>netlab</em> release 1.7.0, you can use the <code>--show</code> option of the <strong>netlab connect</strong> command to execute a single command on a FRR/Cumulus Linux device. For example, to inspect the BGP table, use <code>netlab connect --show ip bgp</code>.</p>
<p>You can quote the <strong>show</strong> commands when they include characters that would confuse <strong>‌bash</strong>, for example <code>netlab connect --show 'ip bgp regexp 65000$'</code></p>
</div>
<p>To configure FRRouting daemons, use the <strong>configure</strong> <em>vtysh</em> command and enter configuration commands similar to those you&rsquo;d use on Cisco IOS or Arista EOS:</p>
<pre><code>x1(bash)#sudo vtysh

Hello, this is FRRouting (version 7.5+cl4.4.0u4).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

x1# configure
x1(config)# router bgp 65100
x1(config-router)#
</code></pre>
<h2 id="sudo">To Sudo Or Not to Sudo</h2>
<p>The <em>vtysh</em> usually has to run as the <strong>root</strong> user, so you should start it with the <code>sudo vtysh</code> command. Unfortunately, things are never as simple as they look:</p>
<ul>
<li>When using SSH, you log into Cumulus Linux or FRRouting virtual machines as a regular user (user <em>vagrant</em> in <em>netlab</em>-created labs) and have to use the <code>sudo</code> command to start <em>vtysh</em>.</li>
<li>Cumulus Linux and FRR containers run as the <strong>root</strong> user, and you connect to them as the <strong>root</strong> user with the <code>docker exec</code> or <code>netlab connect</code> commands<sup id="fnref:WIDUW"><a class="footnote-ref" href="#fn:WIDUW">9</a></sup>. When working with containers, you can start <em>vtysh</em> without using the <code>sudo</code> command.</li>
<li>You can execute <code>sudo vtysh</code> as a root user on Cumulus Linux containers but not within an FRR container. The FRR container does not include the <code>sudo</code> command.</li>
</ul>
<p><strong>Long story short:</strong></p>
<ul>
<li>Use <code>sudo vtysh</code> whenever possible to burn it into your muscle memory.</li>
<li>Use <code>vtysh</code> if you use FRRouting containers as the lab devices.</li>
</ul>
<h2 id="using-output-filters">Using Output Filters</h2>
<p>Unlike many other network operating systems, FRR <code>vtysh</code> does not have output filters. You probably don&rsquo;t need them as you&rsquo;ll be running FRR on top of a Unix-like operating system that supports pipes, but it might be a bit convoluted to use <code>vtysh</code> in a pipe.</p>
<p>To use the <code>vtysh</code> output in a pipe, you have to execute <code>vtysh</code> and get the results of a <strong>show</strong> command in a single command:</p>
<ul>
<li>You could use <code>sudo vtysh -c 'show command'</code> when you&rsquo;re in the <strong>bash</strong> shell of a lab device, for example:</li>
</ul>
<pre><code>$ sudo vtysh -c 'show ip bgp' | grep 32768
*&gt; 192.168.100.0/24 0.0.0.0                  0         32768 i
</code></pre>
<ul>
<li>Alternatively, you could use the <code>netlab connect --show</code> command to execute a <code>vtysh</code> <strong>show</strong> command on a lab device:</li>
</ul>
<pre><code>$ netlab connect x1 --show ip bgp | grep 32768
Connecting to container clab-originate-x1, executing sudo vtysh -c &quot;show ip bgp&quot;
*&gt; 192.168.100.0/24 0.0.0.0                  0         32768 i
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Use <code>netlab connect --quiet --show</code> to omit the <code>Connecting to...</code> message.</p>
</div>
<p>The following table contains a mapping between common network operating system filters and Linux CLI commands:</p>
<table>
<thead>
<tr>
<th>NOS filter</th>
<th>Linux CLI command</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>include</code></td>
<td><code>grep</code></td>
</tr>
<tr>
<td><code>exclude</code></td>
<td><code>grep -v</code></td>
</tr>
<tr>
<td><code>begin</code></td>
<td><code>grep -A 10000</code><sup id="fnref:SLN"><a class="footnote-ref" href="#fn:SLN">10</a></sup></td>
</tr>
<tr>
<td><code>end</code></td>
<td><code>grep -B 10000</code></td>
</tr>
<tr>
<td><code>section</code></td>
<td><em>no equivalent</em></td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:CL">
<p>Including devices based on Linux like Arista EOS, Cisco Nexus OS, or Nokia SR Linux&#160;<a class="footnote-backref" href="#fnref:CL" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:DEV">
<p>The printout details depend on the Linux and FRR versions, but you&rsquo;ll always be able to determine whether the BGP process is running.&#160;<a class="footnote-backref" href="#fnref:DEV" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:UE">
<p>You can use the same command with Cumulus Linux or FRR running in a virtual machine.&#160;<a class="footnote-backref" href="#fnref:UE" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:FRMD">
<p>See <a href="https://docs.nvidia.com/networking-ethernet-software/cumulus-linux-41/Layer-3/Configuring-FRRouting/">Configuring FRRouting</a> Cumulus Linux documentation for more details.&#160;<a class="footnote-backref" href="#fnref:FRMD" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:CLSC">
<p>At least on Cumulus Linux 4.4 used in the BGP labs&#160;<a class="footnote-backref" href="#fnref:CLSC" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:MNS">
<p>You <a href="#sudo">might</a> have to prefix it with <strong>sudo</strong>&#160;<a class="footnote-backref" href="#fnref:MNS" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:TE">
<p><code>vi</code> is available in Cumulus Linux containers. <code>vi</code> and <code>nano</code> are available in Cumulus Linux and FRR virtual machines.&#160;<a class="footnote-backref" href="#fnref:TE" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:ISC">
<p>An euphemism for <em>Cisco IOS CLI</em> that is used when you try to avoid nasty encounters with Cisco&rsquo;s legal team.&#160;<a class="footnote-backref" href="#fnref:ISC" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:WIDUW">
<p>When in doubt, use the <strong>whoami</strong> command.&#160;<a class="footnote-backref" href="#fnref:WIDUW" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:SLN">
<p>The &lsquo;10000&rsquo; parameter specifies the number of lines after the match. Increase it for very long printouts ;)&#160;<a class="footnote-backref" href="#fnref:SLN" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
<hr>
    <p>(C) 2023–2024 Ivan Pepelnjak (ipSpace.net AG)</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
